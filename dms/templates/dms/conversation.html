<!-- 
    Code Source: https://github.com/CoreyMSchafer/code_snippets/tree/master/Django_Blog
    Code Author: Corey Schafer
-->

{% extends "workhuntr/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<body onload="loadDraft()" onbeforeunload="saveDraft()">
    <div class="content-section" style="background-color: #8fbdc7">
        <div class="media">
            <div class="media-body">
                <h2 class="account-heading">{{ contact.username }}</h2>
                {% if conversation %}
                {% for m in conversation %}
                <hr class="rounded">
                {% if m.sender != request.user %}
                <p class="text-secondary" style="text-align:left;"><img class="rounded-circle" width="50" height="50" src="{{ m.sender.profile.profile_picture.url }}">{{ m.sender }}</p><p style="text-align:left;">{{ m.content }}</p><p style="text-align:right;">{{ m.sent_at }}</p></h2>
                {% else %}
                <p class="text-secondary" style="text-align:right;">{{ m.sender }}<img class="rounded-circle" width="50" height="50" src="{{ m.sender.profile.profile_picture.url }}"></p><p style="text-align:right;">{{ m.content }}</p><p style="text-align:left;">{{ m.sent_at }}</p></h2>
                {% endif %}
                {% endfor %}
                {% endif %}
            </div>
        </div>
        <hr class="rounded">
        <h5>
            <form method="POST">
            {% csrf_token %}
                <input type="text" placeholder="Message" name="textarea" id="message" style="background-color: #e3d6ab;">
                <button onclick="deleteDraft()" class="btn btn-outline-info" type="submit" style="background-color: #e3d6ab;">Send</button>
            </form>
            <a href="{% url 'contacts' %}" class="btn btn-outline-info" type="button" style="background-color: #e3d6ab">Back</a>
        </h5>
    </div>
</body>
<script>
function loadDraft() {
    document.getElementById('message').value = localStorage.getItem('message-save');
}
function saveDraft() {
    localStorage.setItem('message-save', document.getElementById('message').value);
}
function deleteDraft() {
    window.onbeforeunload = null;
    localStorage.removeItem('message-save');
}
</script>
{% endblock content %}
